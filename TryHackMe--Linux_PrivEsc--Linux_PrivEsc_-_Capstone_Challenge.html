<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Linux PrivEsc - Capstone Challenge</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Linux PrivEsc - Capstone Challenge</h1><br/><br /><h2>Summary:</h2><br /><br />This is the capstone challenge of a module teaching about privilege escalation under Linux. In this challenge, root access can be gained through a misconfigured binary. The SUID bit of base64 is set allowing us<br />to execute it using the same rights as the root user. Using this binary, we can dump the contents of /etc/shadow and /etc/passwd to crack the passwords locally. Using the cracked passwords, we can log in<br />as another user, who has more rights.<br /><br /><br /><br /><strong>Recon </strong>  <br />   <br />    After executing <code>cat /etc/issue</code> and searching for kernel exploits on Google for kernel version 3.10.0-1160, it looked promising at first. It appeared that it might be vulnerable against CVE-2017-18344, but upon closer inspection that was not the case.<br />    <br />    So there are no kernel exploits.<br />    <br />    <code>sudo -l</code> reveals that we may not execute sudo as user leonard.<br />    <br />    <code>cat /etc/shadow | grep home</code> reveals that there's another user called ‘missy’ on the system.<br />    <br />    After searching for binaries that have the SUID bit set using <br />      <code>  find / -type f -perm -04000 -ls 2&gt;/dev/</code><br />    we can see that /usr/bin/base64 is a candidate for privilege escalation.<br />    <br />    <code>getcap -r / 2&gt;/dev/null</code> doesn't seem to reveal anything of interest.<br />    <br />    There are no running cronjobs either.<br />    <br />    There aren't any misconfigured NFS folders.<br />    <br />    We cannot use the find command to find the locations of the flags. They must be in directories that the user leonard has no access rights to.<br /><br /><br /><strong>What is the content of the flag1.txt file? </strong><br /><br />    Since base64 has the SUID bit set we can use it to dump the contents of /etc/shadow:<br />        <code>base64 /etc/shadow | base64 --decode &gt; ~/shadowcp</code><br />    <br />    We cannot start a Python server to download it onto our attack box. So the contents of it can be copied manually into a file on said attack box. The same can be done for /etc/passwd.<br />    <br />    Afterwards the the files were unshadowed:<br />       <code> unshadow &lt;passwdfile&gt; &lt;shadowfile&gt; &gt; &lt;unshadowedfile&gt;</code><br />        <br />    Now John the Ripper can be used to crack the hashes:<br />        <code>john -wordlist=/usr/share/wordlists/rockyou.txt &lt;unshadowedfile&gt;</code><br />        <br />    This reveals the password of the user missy: Password1<br />    <br />    Now we can log in as missy:<br />        <code>su missy</code><br />        <br />    Executing <code>sudo -l</code> shows us that we can now use the <code>find</code> command together with sudo.<br />    <br />    If we now search for the flags:<br />       <code> sudo find / -name flag*.txt 2&gt;/dev/null</code><br />        <br />    We can see that flag1.txt is in /home/missy/documents and flag2 is in /home/rootflag.<br />    <br />  <strong>  Answer: THM-42828719920544 </strong>   <br />         <br /><br /><br /><strong>What is the content of the flag2.txt file?</strong><br /><br />    Now that we know where the second flag is located we can use base64 again to read the contents of it. We have to do it this way, since we do not have acces to this directory.<br />    <br />    <code>base64 /home/rootflag/flag2.txt | base64 --decode</code><br />    <br /> <strong>   Answer: THM-168824782390238</strong><br /><br /><br /></div></body></html>