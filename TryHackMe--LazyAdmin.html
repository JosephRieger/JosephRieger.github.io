<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>LazyAdmin</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  <script></script>
</head>
<body><div class="page"><h1 class="title">LazyAdmin</h1><br/><br/><h2>Summary:</h2><br /><br />In this challenge, we are presented with an Apache webserver running SweetRice as it's content management system. However, it is not properly secured. It's possible to retrieve and crack the admin password from a hidden<br />directory. After gaining access to the admin dashboard, arbitrary files including reverse shell scripts can be uploaded to gain shell access to the machine. On the machine itself are 2 shell scripts whose access rights are<br />misconfigured. The first script can be executed by the user using sudo and the second script gets executed by the first one. The problem is that the second script can be altered by the user to do anything they want.<br />This allows an attacker to escalate their privileges.<br /><br /><br /><br /><strong>What is the user flag?</strong><br /><br />    After scanning the machine using <code>sudo nmap -A &lt;IP&gt;</code> we can see that port 22 (SSH) and port 80 (HTTP) are open:<br />    <img src="images/115-1.png" alt="images/115-1.png" /><br />    <br />    Since this machine is running a HTTP webserver we can use a browser and see what website it serves. Doing so reveals only the Apache default page.<br />    So next we can use Gobuster to try and enumerate any hidden websites.<br />    <br />    After executing gobuster dir -u 10.10.118.48 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt we can see that, among others, there is a hidden website called /content.<br />    <br />    &lt;---IMG--&gt;<br />    <br />    If we visit that site (&lt;IP&gt;/content) in our browser we can see that somebody has set up the SweetRice Content Management System on this server:<br />    <br />    <img src="images/115-2.png" alt="images/115-2.png" /><br />    <br />    We can now use Google to search for any potential vulnerabilities that SweetRice might have introduced.  What we can find is that SweetRice 1.5.1 discloses backups through the /inc subpage (<a href="https://www.exploit-db.com/exploits/40718">https://www.exploit-db.com/exploits/40718</a>). Indeed, visiting &lt;IP&gt;/content/inc shows us a directory full of files. In this directory, there's another sub-directory called ‘mysql_backup’, which contains ‘mysql_bakup_20191129023059-1.5.1.sql’.<br />    If we download this file and take a closer look at it, we can see that this database file contains what appears to be the username of the admin account as well as its password hash:<br />    <br />        username: manager<br />        hash: 42f749ade7f9e195bf475f37a44cafcb<br /><br />    Next, we can use a website like <a href="https://www.tunnelsup.com/hash-analyzer/">https://www.tunnelsup.com/hash-analyzer/</a> to determine what algorithm was used to produce this hash. This website identifies the hash as an MD5 hash, which is very insecure. Now we can  use John the Ripper to try and crack it:<br />        First, we save this hash in a file and then we can use John as follows.<br />            <code>john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt &lt;file path&gt;</code><br />        To reveal the cracked password we use the --show flag:<br />           <code> john --show --format=raw-md5 &lt;file path&gt;</code><br />            <br />    As it turns out, the cracked password is ‘Password123’. So our login credentials are as follows:<br />        username: manager<br />        password: Password123<br />        <br />    Now, we just need to find out where we can use these credentials to log in.<br />    To do that, we can use Gobuster again. But this time, we'll let it enumerate all websites starting at &lt;IP&gt;/content:<br />        <code>gobuster dir -u &lt;IP&gt;/content -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code><br />    <br />    Using Gobuster reveals a bunch of sites:<br />        <img src="images/115-3.png" alt="images/115-3.png" /><br />    Checking them, we can see that &lt;IP&gt;/content/as is a login portal, where we can try the credentials we just discovered. Doing so, we manage to gain access to the admin portal:<br />        <img src="images/115-4.png" alt="images/115-4.png" /><br />        <br />    Now that we have access to the admin dashboard we can have a look around and see what we can do. One thing that sticks out is that we can now create posts and attach files to them:<br />        <img src="images/115-5.png" alt="images/115-5.png" /><br />        <br />    We can try to gain a remote shell via Pentestmonkey's reverse PHP shell (<a href="https://github.com/pentestmonkey/php-reverse-shell">https://github.com/pentestmonkey/php-reverse-shell</a>). All we need to do is change the IP to that of our attack machine.<br />    However, if we try to upload it as is, it won't work. We also need to change the suffix to .php5. Once we have done that we can access our file at &lt;IP&gt;/content/attachment/&lt;filename&gt;.php5.<br />    <br />    Before we do this, we just need to create a listener. We can easily do this with Netcat:<br />        <code>nc -nlvp 8080</code><br />        <br />    Now, if we access the file we uploaded we should get a reverse shell:<br />        <img src="images/115-6.png" alt="images/115-6.png" /><br />        <br />    If we check which user we are logged in via <code>whoami</code> we can see that we are www-data, the user under which the Apache server runs.<br />    Next we can go to the /home directory to see what other users there are on the system. The only other user with a home directory appears to be itguy.<br />    Inside this folder there's the flag:<br />        <code>cat user.txt</code><br />        <br />    <strong>Answer: THM{63e5bce9271952aad1113b6f1ac28a07}</strong><br />    <br />    <br />    <br />    <br /><strong>What is the root flag?</strong><br /><br />    Perhaps we first want to stabalize our shell to make navigating around the machine a little more comfortable. We can get a bash shell through Python as follows:<br />        <code>python -c 'import pty; pty.spawn("/bin/bash")'</code><br />        <br />    Next, we can poke around a little to see whether or not we can find anything interesting that might help us to escalate our privileges. If we use <code>sudo -l</code> we can see that we are <br />    allowed to use <code>/usr/bin/perl /home/itguy/backup.pl</code> without knowing the sudo password. Checking the file itself, we can see that it executes /etc/copy.sh in a shell. <br />    As it turns out we can read and write to that file. This means that we can write code to create another reverse shell inside this file and then indirectly execute it as root user by<br />    using <code>sudo /usr/bin/perl /home/itguy/backup.pl</code>.<br />    <br />    Let's try it.<br />    <br />    Since we already uploaded a reverse shell script we can just reuse that one. It's located in /var/www/html/content/attachment/. Now all we need to do is to make copy.sh execute it:<br />        <code>echo "php /var/www/html/content/attachment/monkey.php5" &gt; /etc/copy.sh</code><br />        <br />    Then we just need to start another listener on the attack machine and execute backup.pl using sudo. Afterwards we should have root access to the machine. This means that we can<br />    now read the content of /root/root.txt.<br />    <br />   <strong> Answer: THM{6637f41d0177b6f37cb20d775124699f</strong><br /><br /><br />    <br />    <br />    <br /><br />    <br />    <br />    </div></body></html>